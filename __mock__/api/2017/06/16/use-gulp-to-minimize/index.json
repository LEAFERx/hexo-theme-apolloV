{"path":"2017/06/16/use-gulp-to-minimize/","title":"利用 Gulp 来压缩你的 Hexo 博客","date":"2017-06-16T11:50:05.000Z","updated":"2018-03-28T10:31:59.776Z","content":"<p>这篇文章介绍了如何利用 Gulp 来压缩你的 Hexo 博客的静态文件（ html / css / js ），达到提高访问速度的目的。</p>\n<a id=\"more\"></a>\n<hr>\n<p>这篇博文的大部分内容其实是网上抄来的 链接因为忘记了所以没法放 orz<br>写这篇博文呢主要是因为最近把 NexT 升级了 v5.1.1 里面有些 js 用了 ES6 的语法 但 gulp-uglify 并不支持 ES6<br>于是花了点时间看了下 Gulp 的文档 用 gulp-babel 把 ES6 转成 ES5 这样 uglify 就可以用啦<br><del>（发现自己不喜欢打标点orz）</del></p>\n<hr>\n<h1 id=\"Gulp简介\"><a href=\"#Gulp简介\" class=\"headerlink\" title=\"Gulp简介\"></a>Gulp简介</h1><p>gulp.js 是一种基于流的，代码优于配置的新一代构建工具。<br>具体前往<a href=\"http://www.gulpjs.com.cn/\" target=\"_blank\" rel=\"noopener\">官网</a>啦<br>反正是一个基于 node 的用于自动化的工具，和 Grunt 比较类似，不过亮点是 <strong>流</strong> 和 <strong>写代码</strong> ，所以会比 Grunt 快一点。</p>\n<h1 id=\"准备环境\"><a href=\"#准备环境\" class=\"headerlink\" title=\"准备环境\"></a>准备环境</h1><p>首先安装 Gulp</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install gulp -g</span><br></pre></td></tr></table></figure>\n<p>然后 cd 到博客的根目录安装压缩静态文件要用的依赖包</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install gulp-minify-css gulp-babel gulp-uglify gulp-htmlmin gulp-htmlclean --save-dev</span><br></pre></td></tr></table></figure>\n<p><del>（这里提倡使用 cnpm）</del><br><em>2018.03.17：</em><br><em>辣鸡 cnpm 装的包各种权限问题 不推荐了哼</em><br><em>等有空写写如何优雅地在国内使用 npm 好了 w</em></p>\n<h1 id=\"创建gulpfile-js\"><a href=\"#创建gulpfile-js\" class=\"headerlink\" title=\"创建gulpfile.js\"></a>创建gulpfile.js</h1><p>在博客的根目录创建文件 gulpfile.js<br>然后粘贴代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> gulp = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> minifycss = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-minify-css'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> babel = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-babel'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> uglify = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-uglify'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> htmlmin = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-htmlmin'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> htmlclean = <span class=\"built_in\">require</span>(<span class=\"string\">'gulp-htmlclean'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'minify-css'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./public/**/*.css'</span>)</span><br><span class=\"line\">        .pipe(minifycss())</span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./public'</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'minify-html'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src(<span class=\"string\">'./public/**/*.html'</span>)</span><br><span class=\"line\">        .pipe(htmlclean())</span><br><span class=\"line\">        .pipe(htmlmin(&#123;</span><br><span class=\"line\">            removeComments: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            minifyJS: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            minifyCSS: <span class=\"literal\">true</span>,</span><br><span class=\"line\">            minifyURLs: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./public'</span>))</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'minify-js'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> gulp.src([<span class=\"string\">'./public/**/*.js'</span>, <span class=\"string\">'!./public/**/*.min.js'</span>])</span><br><span class=\"line\">        .pipe(babel(&#123; <span class=\"attr\">presets</span>: [<span class=\"string\">'es2015'</span>] &#125;))</span><br><span class=\"line\">        .pipe(uglify())</span><br><span class=\"line\">        .pipe(gulp.dest(<span class=\"string\">'./public'</span>));</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">gulp.task(<span class=\"string\">'default'</span>, [<span class=\"string\">'minify-html'</span>, <span class=\"string\">'minify-css'</span>, <span class=\"string\">'minify-js'</span>]);</span><br></pre></td></tr></table></figure>\n<p><strong>注意</strong><br>gulp-babel 只能转换如箭头函数等一部分 ES6 的新特性 对 import 无能为力 如果需要压缩含有 import 特性的代码 需要使用 webpack 或者 browserify 等工具 具体教程网上有 我因为用不到也就没仔细研究</p>\n<h1 id=\"压缩方法\"><a href=\"#压缩方法\" class=\"headerlink\" title=\"压缩方法\"></a>压缩方法</h1><p>在 hexo g 之后在 cmd 里敲入 gulp 回车就可以啦<br>推荐姿势：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo cl &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d</span><br></pre></td></tr></table></figure>\n<p>gulp运行截图<br><img src=\"https://lc-cqha0xyi.cn-n1.lcfile.com/86504825e54d397ab0b2.jpg\" alt=\"\"></p>\n<p>gulp运行前后比较<br><img src=\"https://lc-cqha0xyi.cn-n1.lcfile.com/563fe13572154f249748.jpg\" alt=\"\"></p>\n<h1 id=\"更为推（tou）荐（lan）的姿势\"><a href=\"#更为推（tou）荐（lan）的姿势\" class=\"headerlink\" title=\"更为推（tou）荐（lan）的姿势\"></a>更为推（tou）荐（lan）的姿势</h1><p><em>2018.03.17更新</em><br>打开博客根目录的 <code>package.json</code> ，在 <code>&quot;scripts&quot;</code> 项增加一个 <code>&quot;publish&quot;</code> 命令：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  //...</span><br><span class=\"line\">  \"scripts\": &#123;</span><br><span class=\"line\">    //...</span><br><span class=\"line\">    \"publish\": \"hexo cl &amp;&amp; hexo g &amp;&amp; gulp &amp;&amp; hexo d\",</span><br><span class=\"line\">    //...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  //...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后每次需要部署的时候只要运行下面命令就可以啦。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run publish</span><br></pre></td></tr></table></figure>\n<p>省了 20 个字符呢 w</p>\n","prev":"2017/06/17/SiteUpdate201706/","next":"2017/06/06/MiNLabSys/"}